{% extends 'base.html' %}
{% block content %}
<h5>{{ user.username }}'s friendships:</h5>
{% include 'friendships/friends-list.html' %}

<h5>{{ user.username }}'s received friend requests:</h5>
{% include 'friendships/friend-requests-list.html' %}

<h5>{{ user.username }}'s emitted friend requests:</h5>
{% include 'friendships/emitted-friend-requests-list.html' %}

<h5>{{ user.username }}'s blocked users:</h5>
{% include 'friendships/blocked-users-list.html' %}

<form method="POST" action="{% url 'send_friend_request' %}">
    {% csrf_token %}
    <input type="text" name="friend_username" placeholder="Enter friend username">
    <button type="submit">Add friend</button>
</form>

{% if messages %}
    {% for message in messages %} 
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<script type="text/javascript">
    const username = "{{ user.username }}";
    const webSocket = new WebSocket(`ws://${window.location.host}/ws/friend-requests/${username}/`);

    webSocket.onopen = function(event) {

    }

    webSocket.onmessage = function(event) {
        const messageData = JSON.parse(event.data);
        const messageText = messageData.message;
        alert(messageText);
        
        // TODO update db and context above
        // Handle incoming WebSocket messages here
    };

    webSocket.onclose = function(event) {
        // Handle WebSocket closing here
    };
</script>
{% endblock %}